<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.6">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.6',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="TO BE OR NOT TO BE.">
<meta property="og:type" content="website">
<meta property="og:title" content="Vcancy&#39;s Home">
<meta property="og:url" content="http://vcancy.github.io/page/2/index.html">
<meta property="og:site_name" content="Vcancy&#39;s Home">
<meta property="og:description" content="TO BE OR NOT TO BE.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vcancy&#39;s Home">
<meta name="twitter:description" content="TO BE OR NOT TO BE.">






  <link rel="canonical" href="http://vcancy.github.io/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Vcancy's Home</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Vcancy's Home</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">电影|阅读|记录</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
</li>

      

      
    </ul>
  

  
    

    
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  


  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/24/Hbase之happybase-TTransportException-Broken-pipe-分析二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/24/Hbase之happybase-TTransportException-Broken-pipe-分析二/" itemprop="url">Hbase之happybase[TTransportException Broken pipe]分析二</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-24T09:26:14+08:00">2018-05-24</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前一篇介绍了使用happybase连接池未关闭连接引起Broken pipe异常</p>
<p>这篇继续分析，当每次我们使用完连接后手动close依然会存在一个问题。</p>
<p>通常我们使用连接池会在全局变量中实例话一个pool对象，后续再通过pool获取连接进行后续操作。</p>
<p>当我们创建连接池对象后，happybase会根据size创建多个connection实例到队列中，同时会将第一个connection连接打开,注释中提到之所以打开一个连接是为了确保如果出现一些找不到主机之类的错误能第一时间发现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class ConnectionPool(object):</span><br><span class="line">    def __init__(self, size, **kwargs):</span><br><span class="line">        if not isinstance(size, int):</span><br><span class="line">            raise TypeError(&quot;Pool &apos;size&apos; arg must be an integer&quot;)</span><br><span class="line"></span><br><span class="line">        if not size &gt; 0:</span><br><span class="line">            raise ValueError(&quot;Pool &apos;size&apos; arg must be greater than zero&quot;)</span><br><span class="line"></span><br><span class="line">        logger.debug(</span><br><span class="line">            &quot;Initializing connection pool with %d connections&quot;, size)</span><br><span class="line"></span><br><span class="line">        self._lock = threading.Lock()</span><br><span class="line">        self._queue = queue.LifoQueue(maxsize=size)</span><br><span class="line">        self._thread_connections = threading.local()</span><br><span class="line"></span><br><span class="line">        connection_kwargs = kwargs</span><br><span class="line">        connection_kwargs[&apos;autoconnect&apos;] = False</span><br><span class="line"></span><br><span class="line">        for i in range(size):</span><br><span class="line">            connection = Connection(**connection_kwargs)</span><br><span class="line">            self._queue.put(connection)</span><br><span class="line"></span><br><span class="line">        # The first connection is made immediately so that trivial</span><br><span class="line">        # mistakes like unresolvable host names are raised immediately.</span><br><span class="line">        # Subsequent connections are connected lazily.</span><br><span class="line">        with self.connection():</span><br><span class="line">            pass</span><br></pre></td></tr></table></figure></p>
<p>但是问题就出现在这里，当我们初始化一个连接池后如果没有立即使用，那么第一个连接池中的连接会出现被断开的情况，那么接下来拿到这个连接去操作都会出现broken pipe异常。</p>
<p>这里只探讨对于这个问题可能的解决方法</p>
<ol>
<li>外部使用的时候为方法增加异常重试，连接池中出现异常本身会重置连接</li>
</ol>
<p>2.第一次不打开连接，如<a href="https://github.com/wbolster/happybase/pull/147" target="_blank" rel="noopener">#147</a>处理方案<br>这个解决新家了一个autoconnect的参数，当autoconnect为False就不执行第一个连接。但是在connection的异常处理中还是会打开一个连接，这样也会出现同样的问题，所以这里也应该加上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    # Open connection, because connections are opened lazily.</span><br><span class="line">    # This is a no-op for connections that are already open.</span><br><span class="line">    connection.open()</span><br><span class="line"></span><br><span class="line">    # Return value from the context manager&apos;s __enter__()</span><br><span class="line">    yield connection</span><br><span class="line"></span><br><span class="line">    connection.close()</span><br><span class="line"></span><br><span class="line">except (TException, socket.error):</span><br><span class="line">    # Refresh the underlying Thrift client if an exception</span><br><span class="line">    # occurred in the Thrift layer, since we don&apos;t know whether</span><br><span class="line">    # the connection is still usable.</span><br><span class="line">    logger.info(&quot;Replacing tainted pool connection&quot;)</span><br><span class="line">    connection._refresh_thrift_client()</span><br><span class="line">    if autoconnect:</span><br><span class="line">        connection.open()</span><br></pre></td></tr></table></figure></p>
<p>3.和1类似，只是在 happybase中处理网络异常重置连接后重试<a href="https://github.com/wbolster/happybase/pull/184" target="_blank" rel="noopener">#184</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/23/Hbase之happybase-TTransportException-Broken-pipe-分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/23/Hbase之happybase-TTransportException-Broken-pipe-分析/" itemprop="url">Hbase之happybase[TTransportException Broken pipe]分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T17:23:00+08:00">2018-05-23</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/大数据/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hbase提供Thrift实现多语言的支持，python的happybase就是其中一个实现。</p>
<p>最近在使用happybase出现TTransportException和Broken pipe的异常，记录一下解决方案。</p>
<p>环境:<br>python:3.6.2<br>happbase:1.1.0<br>hbase:1.2.4</p>
<p>现象：要每几分钟左右往HBase插入一条数据，但是，在大约1分钟过后，被服务器断开了连接，然后再尝试插入的时候，抛出broken pipe.</p>
<p>复现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import happybase</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def put(pool,data):</span><br><span class="line">    with pool.connection() as conn:</span><br><span class="line">        table = conn.table(&apos;Log&apos;)</span><br><span class="line">        row_key = str(int(time.time())) + &apos;000001&apos;</span><br><span class="line">        data = data</span><br><span class="line">        table.put(row_key, data)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    pool = happybase.ConnectionPool(size=3, host=&apos;127.0.0.1&apos;, table_prefix=&apos;TL&apos;)</span><br><span class="line">    put(pool,&#123;&#125;)</span><br><span class="line">    time.sleep(60) # 模拟间隔时间</span><br><span class="line">    put(pool, &#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>分析：Broken pipe往往是因为客户端和服务器的TCP连接断开引起的。</p>
<p>通过google发现hbase thrift server有一个超时的配置hbase.thrift.server.socket.read.timeout，当客户端和服务器的连接超过该值没有收到消息的时候，该连接会被断开，默认值为60秒，正好跟本次现象发生的场景一致，每隔60秒连接断开。参考[HBASE-14926]<a href="https://issues.apache.org/jira/browse/HBASE-14926" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/HBASE-14926</a></p>
<p>查看happybase连接池相关的代码发现在with完成后connection并没有close，直接返回到连接池当中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@contextlib.contextmanager</span><br><span class="line">def connection(self, timeout=None):</span><br><span class="line">    connection = getattr(self._thread_connections, &apos;current&apos;, None)</span><br><span class="line">    return_after_use = False</span><br><span class="line">    if connection is None:</span><br><span class="line">        return_after_use = True</span><br><span class="line">        connection = self._acquire_connection(timeout)</span><br><span class="line">        with self._lock:</span><br><span class="line">            self._thread_connections.current = connection</span><br><span class="line">    try:</span><br><span class="line">        connection.open()</span><br><span class="line">        yield connection</span><br><span class="line">    except (TException, socket.error):</span><br><span class="line">        logger.info(&quot;Replacing tainted pool connection&quot;)</span><br><span class="line">        connection._refresh_thrift_client()</span><br><span class="line">        connection.open()</span><br><span class="line">        raise</span><br><span class="line">    finally:</span><br><span class="line">        if return_after_use:</span><br><span class="line">            del self._thread_connections.current</span><br><span class="line">            self._return_connection(connection)</span><br></pre></td></tr></table></figure>
<p>而问题就出现在这里，返回到连接池中的connection在1分钟后没有使用，被断开了连接，当下一次再拿这个connection去请求资源就会出现Broken pipe的异常。</p>
<p>接下来就到了解决问题的时候，一般来讲可以有两个解决方案：</p>
<p>1.配置hbase.thrift.server.socket.read.timeout，增加超时时间</p>
<p>2.在使用connection后关闭连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import happybase</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def put(pool,data):</span><br><span class="line">    with pool.connection() as conn:</span><br><span class="line">        table = conn.table(&apos;Log&apos;)</span><br><span class="line">        row_key = str(int(time.time())) + &apos;000001&apos;</span><br><span class="line">        data = data</span><br><span class="line">        table.put(row_key, data)</span><br><span class="line">        conn.close() # 关闭连接</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    pool = happybase.ConnectionPool(size=3, host=&apos;127.0.0.1&apos;, table_prefix=&apos;TL&apos;)</span><br><span class="line">    put(pool,&#123;&#125;)</span><br><span class="line">    time.sleep(60) # 模拟间隔时间</span><br><span class="line">    put(pool, &#123;&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/19/docker-常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/docker-常用命令/" itemprop="url">docker 常用命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-19T10:17:00+08:00">2018-05-19</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/备忘录/" itemprop="url" rel="index"><span itemprop="name">备忘录</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker ps 表示查看当前正在运行的容器 </span><br><span class="line"></span><br><span class="line">-a，查看所有容器包括停止状态的容器 </span><br><span class="line"></span><br><span class="line">-l，查看最新创建的容器 </span><br><span class="line"></span><br><span class="line">-n=x，查看最后创建的x个容器</span><br></pre></td></tr></table></figure>
<h3 id="查看容器详细信息"><a href="#查看容器详细信息" class="headerlink" title="查看容器详细信息"></a>查看容器详细信息</h3><pre><code>docker inspect 容器名或容器ID
</code></pre><h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><pre><code>docker exec -it 775c7c9ee1e1 /bin/bash
</code></pre><h3 id="删除-：不能删除一个正在运行的容器，必须先docker-stop或者docker-kill后才能删除"><a href="#删除-：不能删除一个正在运行的容器，必须先docker-stop或者docker-kill后才能删除" class="headerlink" title="删除 ：不能删除一个正在运行的容器，必须先docker stop或者docker kill后才能删除"></a>删除 ：不能删除一个正在运行的容器，必须先docker stop或者docker kill后才能删除</h3><pre><code>docker rm 容器名或容器ID
</code></pre><p>加-f这个参数我们也是可以删除一个正在运行的容器的 </p>
<p>删除所有容器</p>
<pre><code>docker rm `docker ps -a -q` 
</code></pre><h3 id="容器重命名"><a href="#容器重命名" class="headerlink" title="容器重命名"></a>容器重命名</h3><pre><code>docker rename 容器名或容器ID
</code></pre><h3 id="更新容器启动参数"><a href="#更新容器启动参数" class="headerlink" title="更新容器启动参数"></a>更新容器启动参数</h3><pre><code>docker update --restart=no 容器名或容器ID
</code></pre><h3 id="docker-从容器里面拷文件到宿主机"><a href="#docker-从容器里面拷文件到宿主机" class="headerlink" title="docker 从容器里面拷文件到宿主机"></a>docker 从容器里面拷文件到宿主机</h3><pre><code>docker cp 容器名：要拷贝的文件在容器里面的路径       要拷贝到宿主机的相应路径
</code></pre><h3 id="docker-从宿主机拷文件到容器里面"><a href="#docker-从宿主机拷文件到容器里面" class="headerlink" title="docker 从宿主机拷文件到容器里面"></a>docker 从宿主机拷文件到容器里面</h3><pre><code>docker cp 要拷贝的文件路径 容器名：要拷贝到容器里面对应的路径```
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/19/plex-X-Plex-Token-获取/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/plex-X-Plex-Token-获取/" itemprop="url">plex X-Plex-Token 获取</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-19T10:15:00+08:00">2018-05-19</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/智能家居/" itemprop="url" rel="index"><span itemprop="name">智能家居</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.登录plex web：<a href="https://www.plex.tv/" target="_blank" rel="noopener">https://www.plex.tv/</a></p>
<p>2.进入plex desktop</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-db345969a861ce07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>3.开启Chrome开发者工具，刷新页面查看url</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-b021b6b2aae7a246.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/19/树莓派debian-9-stretch-替换apt-get国内源-安装docker-18-03-ce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/树莓派debian-9-stretch-替换apt-get国内源-安装docker-18-03-ce/" itemprop="url">树莓派debian 9 stretch 替换apt-get国内源 安装docker 18.03 ce</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-19T10:14:00+08:00">2018-05-19</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/树莓派/" itemprop="url" rel="index"><span itemprop="name">树莓派</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="配置apt"><a href="#配置apt" class="headerlink" title="配置apt"></a>配置apt</h3><figure class="highlight plain"><figcaption><span>nano</span><a href="/etc/apt/sources.list">```</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">将文件里的默认的官方软件源用# 注释掉,添加以下：</span><br><span class="line"></span><br><span class="line">```deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>nano</span><a href="/etc/apt/sources.list.d/raspi.list```">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">将文件里的默认的官方软件源用# 注释掉,添加以下：</span><br><span class="line"></span><br><span class="line">```deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/ stretch main ui</span><br></pre></td></tr></table></figure>
<h3 id="添加docker-apt源"><a href="#添加docker-apt源" class="headerlink" title="添加docker apt源"></a>添加docker apt源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">echo &quot;deb [arch=armhf] https://download.docker.com/linux/debian \</span><br><span class="line"></span><br><span class="line">    $(lsb_release -cs) stable&quot; | \</span><br><span class="line"></span><br><span class="line">    sudo tee /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure>
<h3 id="更新apt"><a href="#更新apt" class="headerlink" title="更新apt"></a>更新apt</h3><figure class="highlight plain"><figcaption><span>update```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 安装docker</span><br><span class="line"></span><br><span class="line">```sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>
<h3 id="docker配置国内镜像"><a href="#docker配置国内镜像" class="headerlink" title="docker配置国内镜像"></a>docker配置国内镜像</h3><p>在 /etc/docker/daemon.json 中写入如下内容（如果文件不存在请新建该文件）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line"></span><br><span class="line">    &quot;https://registry.docker-cn.com&quot;</span><br><span class="line"></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考</p>
<p><a href="https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce-1" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce-1</a></p>
<p><a href="https://yeasy.gitbooks.io/docker_practice/content/install/mirror.html" target="_blank" rel="noopener">https://yeasy.gitbooks.io/docker_practice/content/install/mirror.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/19/树莓派docker-swarm集群部署-portainer-管理实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/树莓派docker-swarm集群部署-portainer-管理实践/" itemprop="url">树莓派docker swarm集群部署 portainer 管理实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-19T10:09:00+08:00">2018-05-19</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/树莓派/" itemprop="url" rel="index"><span itemprop="name">树莓派</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><img src="https://upload-images.jianshu.io/upload_images/2981143-7fdab9d16e5aedbf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="portainer"></p>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Swarm 在 Docker 1.12 版本之前属于一个独立的项目，在 Docker 1.12 版本发布之后，该项目合并到了 Docker 中，成为 Docker 的一个子命令。目前，Swarm 是 Docker 社区提供的唯一一个原生支持 Docker 集群管理的工具。它可以把多个 Docker 主机组成的系统转换为单一的虚拟 Docker 主机，使得容器可以组成跨主机的子网网络。</p>
<p>Swarm 是目前 Docker 官方唯一指定（绑定）的集群管理工具。Docker 1.12 内嵌了 swarm mode 集群管理模式。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/05/19/树莓派docker-swarm集群部署-portainer-管理实践/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/17/Arduino-Blynk-第一个Demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/17/Arduino-Blynk-第一个Demo/" itemprop="url">Arduino+Blynk 第一个Demo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-17T00:17:00+08:00">2018-05-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Arduino/" itemprop="url" rel="index"><span itemprop="name">Arduino</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Arduino起步项目：通过Blynk应用程序控制板载LED</p>
<h3 id="需要："><a href="#需要：" class="headerlink" title="需要："></a>需要：</h3><p>Arduino UNO</p>
<p>Blynk</p>
<h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><ol>
<li>下载Blynk并注册账号登录app</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-75651409a44f7920.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="2">
<li>创建一个项目，创建成功后Blynk会发送一封包含Auth Token的邮件</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-47de8ce02759de10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-e92067ea89303a78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="3">
<li>在app上添加widgets</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-90ee9b2dd52b53a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="4">
<li>在本例子中我添加一个按钮，设置为Switch开关，同时选择D13作为控制点<br><img src="https://upload-images.jianshu.io/upload_images/2981143-1d1437ba4e239018.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ol>
<h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><ol>
<li>下载Blynk Libraries <a href="https://github.com/blynkkk/blynk-library/releases/latest" target="_blank" rel="noopener">https://github.com/blynkkk/blynk-library/releases/latest</a></li>
</ol>
<p>解压并复制到Arduino IDE的Libraries目录</p>
<p>Windows: File → Preferences<br>Mac OS: Arduino → Preferences</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-a840e5f599296d6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="2">
<li>打开<a href="https://examples.blynk.cc/" target="_blank" rel="noopener">https://examples.blynk.cc/</a> 网页，选择Arduino UNO，选择Serial or USB 串口共享电脑的网络连接</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-5bc27f18b30cb539.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="3">
<li>复制代码到IDE并烧录到 Arduino Uno<br><img src="https://upload-images.jianshu.io/upload_images/2981143-2fefe1d37b7f1760.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ol>
<h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><ol>
<li>打开终端进入到Libraries的Blynk路径下的scripts目录</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-a093b470a7d1ff3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="2">
<li>执行./blynk-ser.sh 提示需要安装socat </li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-dfc63e80b249c537.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="3">
<li>再次执行脚本，这里注意：我执行后没有显示串口的地址，可以通过-c参数手动指定<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./blynk-ser.sh -c /dev/cu.wchusbserial1420</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>/dev/cu.wchusbserial1420可以从Arduino IDE中查看</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-25a93cec94d1b911.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-c0e1cd4b165ea992.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/2981143-fcd51ba1ead4df06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ol start="4">
<li>最后打开Blynk app，点击运行，就可以通过button按钮控制Arduino Uno的IDE了<br><img src="https://upload-images.jianshu.io/upload_images/2981143-ab57623fec2aa2d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/15/SqlAlchemy实践-seesion管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/15/SqlAlchemy实践-seesion管理/" itemprop="url">[SqlAlchemy实践]seesion线程安全管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-15T22:54:00+08:00">2018-05-15</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>普通情况下session使用情况如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line"></span><br><span class="line">engine = create_engine(&apos;sqlite:///:memory:&apos;, echo=True)</span><br><span class="line">DB_Session = sessionmaker(bind=engine)</span><br><span class="line">session = DB_Session()</span><br></pre></td></tr></table></figure>
<p>这种在单线程场景是没有问题的，但是在多线程场景下就不适用了。</p>
<p>我们可以通过scoped_session来实现多线程场景下的应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy.orm import scoped_session</span><br><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line">from contextlib import contextmanager</span><br><span class="line">from sqlalchemy import create_engine, MetaData</span><br><span class="line"></span><br><span class="line"># 线程安全session</span><br><span class="line">engine = create_engine(&quot;mysql+pymysql://root:123456@127.0.0.1:3306/mydb?charset=utf8&quot;)</span><br><span class="line"></span><br><span class="line">session_factory = sessionmaker(bind=engine)</span><br><span class="line">sc_session = scoped_session(session_factory)</span><br><span class="line"></span><br><span class="line">@contextmanager</span><br><span class="line">def session_scope():</span><br><span class="line">    &quot;&quot;&quot;Provide a transactional scope around a series of operations.&quot;&quot;&quot;</span><br><span class="line">    session = sc_session()</span><br><span class="line">    try:</span><br><span class="line">        yield session</span><br><span class="line">    except:</span><br><span class="line">        raise</span><br><span class="line">    finally:</span><br><span class="line">        sc_session.remove()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/10/MySQL数据库规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/10/MySQL数据库规范/" itemprop="url">MySQL数据库规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-10T09:02:00+08:00">2018-05-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>目录</p>
<p>基础规范<br>命名规范<br>表设计规范</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/05/10/MySQL数据库规范/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vcancy.github.io/2018/05/10/《联盟》/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vcancy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vcancy's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/10/《联盟》/" itemprop="url">《联盟》</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-10T08:49:00+08:00">2018-05-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/书/" itemprop="url" rel="index"><span itemprop="name">书</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>《联盟》 里德霍夫曼</p>
<p>新的互联网时代背景下，人们已经从传统的终身职员转变为自由职员。公司与员工达成联盟关系，公司为员工提供有利于职业发展的环境、资源、机会，员工通过个人成长为公司创造价值，也为接下来的职业生涯增加资本。</p>
<h4 id="如何达成联盟关系"><a href="#如何达成联盟关系" class="headerlink" title="如何达成联盟关系"></a>如何达成联盟关系</h4><h5 id="通过诚实对话建立互信"><a href="#通过诚实对话建立互信" class="headerlink" title="通过诚实对话建立互信"></a>通过诚实对话建立互信</h5><p>公司承诺员工在职期间的职业能力提升</p>
<p>员工承诺在职期间完成任务、解决问题、创造价值</p>
<h5 id="任期制"><a href="#任期制" class="headerlink" title="任期制"></a>任期制</h5><p>轮转期：双方判断对方是否适合</p>
<p>转变期：员工为公司产生价值，公司为员工创建职业提升条件</p>
<p>基础期：员工和公司的目标和价值一致</p>
<h5 id="利用好员工人脉关系"><a href="#利用好员工人脉关系" class="headerlink" title="利用好员工人脉关系"></a>利用好员工人脉关系</h5><p>通过员工人脉为公司发展、决策提供信息</p>
<p>利用好前员工资源</p>
<p>总结：</p>
<ol>
<li><p>拿出彼此诚意（公司类似球队非家庭）</p>
</li>
<li><p>适合就干 (互利才能共赢)</p>
</li>
<li><p>不适合就散（保持联系）</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Vcancy" />
            
              <p class="site-author-name" itemprop="name">Vcancy</p>
              <p class="site-description motion-element" itemprop="description">TO BE OR NOT TO BE.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">66</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/vcancy" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yujie.teddy@outlook.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate"> 
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vcancy</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.6</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
